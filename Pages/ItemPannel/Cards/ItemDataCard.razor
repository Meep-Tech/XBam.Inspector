@using Meep.Tech.Collections.Generic
@using Xbam.Inspector.Shared.Components
@inherits Card

<div class="card-container @(!IsExpanded ? "closed" : "")">
    <div 
        class="card @(!IsExpanded ? "closed" : "")" 
        style="background-color: @(CurrentMainColor);">
        <nav 
            class="navbar navbar-expand-lg navbar-dark justify-content-between" 
            style="min-width:300px;height:35px;background-color:@(CurrentMainColor);">
            <span class="navbar-brand mb-0 h1" style="margin-left:10px">@Title</span>
            <button
                title="Toggle Expanded"
                @onclick=@(() => ToggleExpanded())
                style="background-color:@(CurrentMainColor);color:white;width:30px;height:30px;">
                @ExpandToggleSymbol</button>
        </nav>
        @if(IsExpanded) {
            <div
                class="card-content" 
                style="color:white;min-width:300px;min-height:200px;background-color:#222222;padding:5px">
                @ChildContent
            </div>
        }
    </div>
</div>

@code {

    [Parameter, EditorRequired]
    public string ItemId {
        get;
        set;
    }

    [Parameter, EditorRequired]
    public string TabId {
        get;
        set;
    }

    protected override void OnInitialized() {
        State = Pages.Index
            .TabState[TabId]
            .ItemsState.TryToGet(ItemId, new())
            .CardsState.TryToGet(Title, new() {IsExpanded = DomProvidedIsExpandedValue ?? true});

        base.OnInitialized();
    }
}
